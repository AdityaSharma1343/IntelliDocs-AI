<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>IntelliDocs AI - Intelligent Document Search Portal</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      :root {
        --primary-color: #1e3c72;
        --secondary-color: #2a5298;
        --success-color: #28a745;
        --danger-color: #dc3545;
        --warning-color: #ffc107;
        --info-color: #17a2b8;
        --light-bg: #ffffff;
        --light-text: #333333;
        --light-border: #e0e0e0;
        --light-hover: #f8f9fa;
        --dark-bg: #1a1a1a;
        --dark-card: #2d2d2d;
        --dark-text: #ffffff;
        --dark-border: #404040;
        --dark-hover: #3a3a3a;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        transition:
          background-color 0.3s ease,
          color 0.3s ease;
      }

      body {
        font-family: "Poppins", sans-serif;
        background: linear-gradient(
          135deg,
          var(--primary-color) 0%,
          var(--secondary-color) 100%
        );
        min-height: 100vh;
        transition: all 0.3s ease;
      }

      body.dark-mode {
        background: linear-gradient(135deg, #0f0f0f 0%, #1a1a1a 100%);
      }

      body.dark-mode .navbar,
      body.dark-mode .search-section,
      body.dark-mode .results-section,
      body.dark-mode .upload-section,
      body.dark-mode .recent-docs,
      body.dark-mode .modal-content,
      body.dark-mode .folder-section {
        background: var(--dark-card);
        color: var(--dark-text);
      }

      body.dark-mode .search-input,
      body.dark-mode .sort-dropdown,
      body.dark-mode .filter-chip {
        background: var(--dark-bg);
        color: var(--dark-text);
        border-color: var(--dark-border);
      }

      body.dark-mode .result-item {
        background: var(--dark-bg);
        border-color: var(--dark-border);
      }

      body.dark-mode .result-item:hover {
        background: var(--dark-hover);
      }

      body.dark-mode .filter-chip.active {
        background: var(--primary-color);
        color: white;
      }

      body.dark-mode .upload-area {
        border-color: var(--dark-border);
        background: var(--dark-bg);
      }

      body.dark-mode .upload-area:hover {
        background: var(--dark-hover);
      }

      .navbar {
        background: rgba(255, 255, 255, 0.98);
        padding: 1rem 2rem;
        box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
        backdrop-filter: blur(10px);
      }

      body.dark-mode .navbar {
        background: rgba(45, 45, 45, 0.98);
      }

      .logo-container {
        display: flex;
        align-items: center;
        gap: 15px;
        position: relative;
      }

      .logo-icon {
        width: 45px;
        height: 45px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.3rem;
        color: white;
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        transition:
          transform 0.3s ease,
          box-shadow 0.3s ease;
      }

      .logo-icon:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(102, 126, 234, 0.5);
      }

      .logo-text {
        display: flex;
        flex-direction: column;
      }

      .logo-title {
        font-size: 1.4rem;
        font-weight: 800;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        letter-spacing: -0.5px;
        line-height: 1;
      }

      .logo-subtitle {
        font-size: 0.75rem;
        font-weight: 500;
        color: #888;
        letter-spacing: 2px;
        text-transform: uppercase;
        margin-top: 2px;
      }

      body.dark-mode .logo-subtitle {
        color: #aaa;
      }

      .logo-beta {
        position: absolute;
        top: -5px;
        right: -35px;
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
        font-size: 0.6rem;
        padding: 2px 6px;
        border-radius: 6px;
        font-weight: 600;
        text-transform: uppercase;
      }

      .theme-toggle {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: var(--primary-color);
        color: white;
        border: none;
        cursor: pointer;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        z-index: 1000;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        transition: transform 0.3s ease;
      }

      .theme-toggle:hover {
        transform: scale(1.1);
      }

      .stats {
        display: flex;
        gap: 20px;
        align-items: center;
      }

      .stat-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 5px 15px;
        background: #f0f4f8;
        border-radius: 8px;
      }

      body.dark-mode .stat-item {
        background: var(--dark-bg);
      }

      .stat-value {
        font-size: 1.2rem;
        font-weight: 600;
        color: var(--primary-color);
      }

      .stat-label {
        font-size: 0.75rem;
        color: #666;
      }

      body.dark-mode .stat-label {
        color: #aaa;
      }

      .refresh-button {
        position: relative;
        padding: 0.75rem 1.5rem;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 12px;
        cursor: pointer;
        font-weight: 600;
        font-size: 0.9rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        overflow: hidden;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
      }

      .refresh-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
      }

      .refresh-button:active {
        transform: translateY(0);
      }

      .refresh-button.spinning .refresh-icon {
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        from {
          transform: rotate(0deg);
        }
        to {
          transform: rotate(360deg);
        }
      }

      .container {
        max-width: 1400px;
        margin: 2rem auto;
        padding: 0 20px;
      }

      .search-section {
        background: white;
        border-radius: 16px;
        padding: 2rem;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        margin-bottom: 2rem;
        position: relative;
        overflow: hidden;
      }

      .search-header {
        text-align: center;
        margin-bottom: 2rem;
        position: relative;
        padding: 2rem;
        background: linear-gradient(
          135deg,
          rgba(102, 126, 234, 0.08) 0%,
          rgba(118, 75, 162, 0.08) 100%
        );
        border-radius: 16px;
      }

      body.dark-mode .search-header {
        background: linear-gradient(
          135deg,
          rgba(102, 126, 234, 0.15) 0%,
          rgba(118, 75, 162, 0.15) 100%
        );
      }

      .search-header h1 {
        font-size: 2.5rem;
        font-weight: 800;
        margin-bottom: 0.5rem;
        background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 1rem;
      }

      body.dark-mode .search-header h1 {
        background: linear-gradient(135deg, #667eea 0%, #a78bfa 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .search-header .brain-icon {
        font-size: 2.5rem;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .search-header p {
        font-size: 1.1rem;
        color: #666;
        font-weight: 500;
        letter-spacing: 0.5px;
      }

      body.dark-mode .search-header p {
        color: #bbb;
      }

      .search-tagline {
        display: inline-block;
        padding: 0.5rem 1.5rem;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 25px;
        font-size: 0.9rem;
        font-weight: 600;
        margin-top: 1rem;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
      }

      .search-box {
        position: relative;
        margin-bottom: 1rem;
      }

      .search-input {
        width: 100%;
        padding: 1rem 3rem 1rem 1rem;
        font-size: 1.1rem;
        border: 2px solid #e0e0e0;
        border-radius: 12px;
        transition: all 0.3s;
      }

      .search-input:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(30, 60, 114, 0.1);
      }

      .search-btn {
        position: absolute;
        right: 5px;
        top: 50%;
        transform: translateY(-50%);
        background: var(--primary-color);
        color: white;
        border: none;
        padding: 0.7rem 1.5rem;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 500;
        transition: background 0.3s;
      }

      .search-btn:hover {
        background: var(--secondary-color);
      }

      .filters {
        display: flex;
        gap: 1rem;
        margin-bottom: 1rem;
        flex-wrap: wrap;
      }

      .filter-chip {
        padding: 0.5rem 1rem;
        background: #f0f4f8;
        border: 1px solid #ddd;
        border-radius: 20px;
        cursor: pointer;
        transition: all 0.3s;
        font-size: 0.9rem;
      }

      .filter-chip:hover {
        background: #e0e7ef;
        transform: translateY(-2px);
      }

      .filter-chip.active {
        background: var(--primary-color);
        color: white;
        border-color: var(--primary-color);
      }

      .folder-section {
        background: white;
        border-radius: 16px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
      }

      .folder-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 1rem;
        margin-top: 1rem;
      }

      @media (min-width: 1200px) {
        .folder-grid {
          grid-template-columns: repeat(
            7,
            1fr
          ); /* Show all 7 folders in one row on large screens */
        }
      }

      @media (min-width: 768px) and (max-width: 1199px) {
        .folder-grid {
          grid-template-columns: repeat(
            4,
            1fr
          ); /* 4 folders per row on medium screens */
        }
      }

      @media (max-width: 767px) {
        .folder-grid {
          grid-template-columns: repeat(
            2,
            1fr
          ); /* 2 folders per row on mobile */
        }
      }

      .folder-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 1rem;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s;
        position: relative;
      }

      body.dark-mode .folder-item {
        background: linear-gradient(
          135deg,
          var(--dark-bg) 0%,
          var(--dark-hover) 100%
        );
      }

      .folder-item:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }

      .folder-icon {
        font-size: 3rem;
        margin-bottom: 0.5rem;
      }

      .folder-name {
        font-size: 0.9rem;
        font-weight: 500;
        text-align: center;
      }

      .folder-count {
        font-size: 0.75rem;
        color: #666;
        margin-top: 0.25rem;
      }

      body.dark-mode .folder-count {
        color: #aaa;
      }

      .folder-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.7);
        z-index: 2000;
        align-items: center;
        justify-content: center;
      }

      .folder-modal.show {
        display: flex;
      }

      .folder-modal-content {
        background: white;
        border-radius: 16px;
        padding: 2rem;
        max-width: 800px;
        width: 90%;
        max-height: 70vh;
        overflow-y: auto;
      }

      body.dark-mode .folder-modal-content {
        background: var(--dark-card);
        color: var(--dark-text);
      }

      .recent-docs {
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
        border-radius: 20px;
        padding: 1.8rem;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        max-height: 500px;
        overflow: hidden;
        position: relative;
      }

      body.dark-mode .recent-docs {
        background: linear-gradient(
          135deg,
          var(--dark-card) 0%,
          var(--dark-bg) 100%
        );
      }

      .recent-docs-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 2px solid var(--light-border);
      }

      body.dark-mode .recent-docs-header {
        border-bottom-color: var(--dark-border);
      }

      .recent-docs-title {
        font-size: 1.2rem;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: var(--primary-color);
      }

      .recent-docs-list {
        max-height: 380px;
        overflow-y: auto;
        padding-right: 0.5rem;
      }

      .recent-doc-item {
        display: flex;
        align-items: center;
        padding: 1rem;
        margin-bottom: 0.75rem;
        background: white;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
        border: 1px solid transparent;
        position: relative;
        overflow: hidden;
      }

      body.dark-mode .recent-doc-item {
        background: var(--dark-bg);
      }

      .recent-doc-item:hover {
        transform: translateX(5px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        border-color: var(--primary-color);
      }

      .recent-doc-icon {
        width: 40px;
        height: 40px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        margin-right: 1rem;
        flex-shrink: 0;
      }

      .recent-doc-icon.pdf {
        background: rgba(220, 53, 69, 0.1);
        color: #dc3545;
      }

      .recent-doc-icon.word {
        background: rgba(0, 123, 255, 0.1);
        color: #007bff;
      }

      .recent-doc-icon.excel {
        background: rgba(40, 167, 69, 0.1);
        color: #28a745;
      }

      .recent-doc-icon.text {
        background: rgba(108, 117, 125, 0.1);
        color: #6c757d;
      }

      .recent-doc-info {
        flex: 1;
        min-width: 0;
      }

      .recent-doc-title {
        font-weight: 600;
        color: var(--light-text);
        margin-bottom: 0.25rem;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      body.dark-mode .recent-doc-title {
        color: var(--dark-text);
      }

      .recent-doc-meta {
        font-size: 0.75rem;
        color: #999;
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .toast-container {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 2000;
      }

      .toast {
        background: white;
        padding: 1rem 1.5rem;
        border-radius: 12px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 1rem;
        min-width: 300px;
        animation: slideIn 0.3s ease;
      }

      body.dark-mode .toast {
        background: var(--dark-card);
        color: var(--dark-text);
      }

      @keyframes slideIn {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      .toast.success {
        border-left: 4px solid var(--success-color);
      }
      .toast.error {
        border-left: 4px solid var(--danger-color);
      }

      .upload-progress {
        margin-top: 1rem;
        display: none;
      }

      .progress-bar {
        width: 100%;
        height: 8px;
        background: #e0e0e0;
        border-radius: 4px;
        overflow: hidden;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        transition: width 0.3s ease;
      }

      .empty-state {
        text-align: center;
        padding: 3rem;
        color: #999;
      }

      .empty-icon {
        font-size: 4rem;
        margin-bottom: 1rem;
        opacity: 0.3;
      }

      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        align-items: center;
        justify-content: center;
      }

      .modal.show {
        display: flex;
      }

      .modal-content {
        background: white;
        border-radius: 16px;
        padding: 2rem;
        max-width: 800px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
      }

      .main-content {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 2rem;
      }

      .results-section {
        background: white;
        border-radius: 16px;
        padding: 1.5rem;
        min-height: 400px;
      }

      .sidebar {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
      }

      .upload-section {
        background: white;
        border-radius: 16px;
        padding: 1.5rem;
      }

      body.dark-mode #searchResults > div {
        background: var(--dark-card) !important;
        color: var(--dark-text) !important;
        border-color: var(--dark-border) !important;
      }

      body.dark-mode #modalBody {
        background: var(--dark-card) !important;
        color: var(--dark-text) !important;
      }

      @media (max-width: 768px) {
        .main-content {
          grid-template-columns: 1fr;
        }

        .navbar {
          flex-direction: column;
          gap: 1rem;
        }
      }
      /* Add this to your existing <style> section */
      body.dark-mode .stat-value {
        color: #667eea; /* Make stat values visible in dark mode */
      }
      /* Add this to your existing <style> section */
      body.dark-mode .recent-docs-title {
        color: #667eea; /* Make recent docs title visible in dark mode */
      }
      /* Add these lines to your existing <style> section, before the closing tag */

      /* Fix stat values in dark mode */
      body.dark-mode .stat-value {
        color: #667eea;
      }

      /* Fix recent docs title in dark mode */
      body.dark-mode .recent-docs-title {
        color: #667eea;
      }

      /* Fix modal content text in dark mode */
      body.dark-mode #modalBody h3,
      body.dark-mode #modalBody h4,
      body.dark-mode #modalBody p,
      body.dark-mode #modalBody div {
        color: var(--dark-text) !important;
      }

      /* Ensure modal background is proper in dark mode */
      body.dark-mode #modalBody {
        background: var(--dark-card) !important;
      }

      /* Fix the preview content area in dark mode */
      body.dark-mode #modalBody > div > div:last-of-type {
        background: var(--dark-bg) !important;
      }

      body.dark-mode .folder-file-item {
        background: var(--dark-bg) !important;
      }

      body.dark-mode .folder-file-item > div > div > div:first-child {
        color: var(--dark-text) !important;
      }

      body.dark-mode .folder-file-item > div > div > div:last-child {
        color: #aaa !important;
      }

      /* Fix stat values in dark mode */
      body.dark-mode .stat-value {
        color: #667eea;
      }

      /* Fix recent docs title in dark mode */
      body.dark-mode .recent-docs-title {
        color: #667eea;
      }

      /* Add to your <style> section */

      /* Better modal scrolling */
      #modalBody {
        max-height: calc(80vh - 100px);
        overflow-y: auto;
      }

      /* Style the content area scrollbar */
      #modalBody > div > div:nth-child(3) {
        scrollbar-width: thin;
        scrollbar-color: #888 #f1f1f1;
      }

      #modalBody > div > div:nth-child(3)::-webkit-scrollbar {
        width: 8px;
      }

      #modalBody > div > div:nth-child(3)::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 4px;
      }

      #modalBody > div > div:nth-child(3)::-webkit-scrollbar-thumb {
        background: #888;
        border-radius: 4px;
      }

      #modalBody > div > div:nth-child(3)::-webkit-scrollbar-thumb:hover {
        background: #555;
      }

      /* Dark mode scrollbar */
      body.dark-mode
        #modalBody
        > div
        > div:nth-child(3)::-webkit-scrollbar-track {
        background: var(--dark-bg);
      }

      body.dark-mode
        #modalBody
        > div
        > div:nth-child(3)::-webkit-scrollbar-thumb {
        background: #555;
      }

      /* Fix Upload Section Title in Dark Mode */
      body.dark-mode .upload-section h3 {
        color: #667eea;
      }

      /* Fix Ready to Search text in Dark Mode */
      body.dark-mode .result-count {
        color: #667eea;
      }

      /* Fix document preview from folders in dark mode */
      body.dark-mode #modalBody h3,
      body.dark-mode #modalBody h4 {
        color: var(--dark-text) !important;
      }

      body.dark-mode #modalBody p,
      body.dark-mode #modalBody div {
        color: var(--dark-text) !important;
      }

      /* Fix content area background in modal for dark mode */
      body.dark-mode #modalBody > div > div[style*="background"] {
        background: var(--dark-bg) !important;
        color: var(--dark-text) !important;
      }
    </style>
  </head>
  <body>
    <!-- Theme Toggle Button -->
    <button
      class="theme-toggle"
      onclick="toggleTheme()"
      title="Toggle Dark Mode"
    >
      <i class="fas fa-moon" id="themeIcon"></i>
    </button>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Folder Modal -->
    <div class="folder-modal" id="folderModal">
      <div class="folder-modal-content">
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
          "
        >
          <h2 id="folderModalTitle">üìÅ Folder Contents</h2>
          <button
            onclick="closeFolderModal()"
            style="
              background: none;
              border: none;
              font-size: 1.5rem;
              cursor: pointer;
            "
          >
            √ó
          </button>
        </div>
        <div class="folder-files-list" id="folderFilesList"></div>
      </div>
    </div>

    <!-- Navigation Bar -->
    <nav class="navbar">
      <div class="logo-container">
        <div class="logo-icon">
          <i class="fas fa-brain"></i>
        </div>
        <div class="logo-text">
          <div class="logo-title">IntelliDocs AI</div>
          <div class="logo-subtitle">Smart Document Portal</div>
        </div>
        <span class="logo-beta">v2.0</span>
      </div>
      <div class="stats">
        <div class="stat-item">
          <span class="stat-value" id="totalDocs">0</span>
          <span class="stat-label">Documents</span>
        </div>
        <div class="stat-item">
          <span class="stat-value" id="totalFolders">7</span>
          <span class="stat-label">Folders</span>
        </div>
        <div class="stat-item">
          <span class="stat-value" id="searchCount">0</span>
          <span class="stat-label">Searches</span>
        </div>
        <button class="refresh-button" onclick="refreshAll()">
          <i class="fas fa-sync-alt refresh-icon" id="refreshIcon"></i>
          <span>Refresh</span>
        </button>
      </div>
    </nav>

    <div class="container">
      <!-- Folder Organization -->
      <div class="folder-section">
        <h3>üìÅ Document Folders (Click to Open)</h3>
        <div class="folder-grid">
          <div class="folder-item" onclick="openFolder('All')">
            <i
              class="fas fa-folder-open folder-icon"
              style="color: #6c757d"
            ></i>
            <span class="folder-name">All Documents</span>
            <span class="folder-count" id="folderCountAll">0 files</span>
          </div>
          <div class="folder-item" onclick="openFolder('PDF')">
            <i class="fas fa-folder folder-icon" style="color: #dc3545"></i>
            <span class="folder-name">PDF Files</span>
            <span class="folder-count" id="folderCountPDF">0 files</span>
          </div>
          <div class="folder-item" onclick="openFolder('Word')">
            <i class="fas fa-folder folder-icon" style="color: #007bff"></i>
            <span class="folder-name">Word Documents</span>
            <span class="folder-count" id="folderCountWord">0 files</span>
          </div>
          <div class="folder-item" onclick="openFolder('Excel')">
            <i class="fas fa-folder folder-icon" style="color: #28a745"></i>
            <span class="folder-name">Excel Files</span>
            <span class="folder-count" id="folderCountExcel">0 files</span>
          </div>
          <div class="folder-item" onclick="openFolder('CSV')">
            <i class="fas fa-folder folder-icon" style="color: #20c997"></i>
            <span class="folder-name">CSV Files</span>
            <span class="folder-count" id="folderCountCSV">0 files</span>
          </div>
          <div class="folder-item" onclick="openFolder('PowerPoint')">
            <i class="fas fa-folder folder-icon" style="color: #ffc107"></i>
            <span class="folder-name">PowerPoint</span>
            <span class="folder-count" id="folderCountPowerPoint">0 files</span>
          </div>
          <div class="folder-item" onclick="openFolder('Text')">
            <i class="fas fa-folder folder-icon" style="color: #17a2b8"></i>
            <span class="folder-name">Text Files</span>
            <span class="folder-count" id="folderCountText">0 files</span>
          </div>
        </div>
      </div>

      <!-- Search Section -->
      <div class="search-section">
        <div class="search-header">
          <h1>
            <i class="fas fa-brain brain-icon"></i>
            IntelliDocs AI Search
          </h1>
          <p>Intelligent Document Search Powered by Azure AI</p>
          <div class="search-tagline">üöÄ Find Any Document in Seconds</div>
        </div>

        <div class="search-box">
          <input
            type="text"
            id="searchInput"
            class="search-input"
            placeholder="Search for documents, keywords, or topics..."
            onkeypress="if(event.key === 'Enter') Search()"
          />
          <button class="search-btn" onclick="Search()">
            <i class="fas fa-search"></i> Search
          </button>
        </div>
        <!-- Filters -->
        <div class="filters">
          <div class="filter-chip active" onclick="toggleFilter(this, 'all')">
            All Documents
          </div>
          <div class="filter-chip" onclick="toggleFilter(this, 'PDF')">PDF</div>
          <div class="filter-chip" onclick="toggleFilter(this, 'Word')">
            Word
          </div>
          <div class="filter-chip" onclick="toggleFilter(this, 'Excel')">
            Excel
          </div>
          <div class="filter-chip" onclick="toggleFilter(this, 'CSV')">CSV</div>
          <div class="filter-chip" onclick="toggleFilter(this, 'PowerPoint')">
            PowerPoint
          </div>
          <div class="filter-chip" onclick="toggleFilter(this, 'Text')">
            Text
          </div>
        </div>
      </div>

      <!-- Main Content Grid -->
      <div class="main-content">
        <!-- Search Results -->
        <div class="results-section">
          <div
            class="results-header"
            style="
              display: flex;
              justify-content: space-between;
              align-items: center;
              margin-bottom: 1rem;
            "
          >
            <span class="result-count" style="font-weight: 600; color: #333"
              >Ready to search</span
            >
            <select
              class="sort-dropdown"
              onchange="sortResults(this.value)"
              style="
                padding: 0.5rem;
                border: 1px solid #ddd;
                border-radius: 8px;
              "
            >
              <option value="relevance">Sort by Relevance</option>
              <option value="date">Sort by Date</option>
              <option value="title">Sort by Title</option>
            </select>
          </div>
          <div id="searchResults">
            <div class="empty-state">
              <div class="empty-icon">
                <i class="fas fa-file-search"></i>
              </div>
              <h3>Start Searching</h3>
              <p>Enter keywords to find relevant documents</p>
            </div>
          </div>
        </div>

        <!-- Sidebar -->
        <div class="sidebar">
          <!-- Upload Section -->
          <div class="upload-section">
            <h3 style="margin-bottom: 1rem">üì§ Upload Document</h3>
            <div
              class="bulk-upload-area"
              id="bulkUploadArea"
              ondrop="handleSingleDrop(event)"
              ondragover="handleDragOver(event)"
              ondragleave="handleDragLeave(event)"
              style="
                border: 3px dashed var(--primary-color);
                border-radius: 16px;
                padding: 2rem;
                text-align: center;
              "
            >
              <div class="upload-icon">
                <i
                  class="fas fa-cloud-upload-alt"
                  style="font-size: 3rem; color: var(--primary-color)"
                ></i>
              </div>
              <div
                class="upload-text"
                style="font-size: 1.1rem; font-weight: 600; margin: 1rem 0"
              >
                Drag & drop a file here
              </div>
              <p style="font-size: 0.85rem; color: #999; margin: 1rem 0">
                Supports: PDF, Word, Excel, PowerPoint, Text, CSV
              </p>
              <input
                type="file"
                id="fileInput"
                accept=".pdf,.docx,.doc,.xlsx,.xls,.pptx,.ppt,.txt,.csv"
                onchange="handleSingleFile(event)"
                style="display: none"
              />
              <button
                class="btn"
                onclick="document.getElementById('fileInput').click()"
                style="
                  padding: 0.75rem 1.5rem;
                  background: var(--primary-color);
                  color: white;
                  border: none;
                  border-radius: 8px;
                  cursor: pointer;
                  font-weight: 600;
                "
              >
                <i class="fas fa-folder-open"></i> Browse File
              </button>

              <div class="upload-progress" id="uploadProgress">
                <div class="progress-bar" style="margin-top: 1rem">
                  <div
                    class="progress-fill"
                    id="progressFill"
                    style="width: 0%"
                  ></div>
                </div>
                <div
                  class="upload-status-text"
                  id="uploadStatusText"
                  style="margin-top: 0.5rem"
                >
                  Uploading...
                </div>
              </div>
            </div>
          </div>

          <!-- Recent Documents -->
          <div class="recent-docs">
            <div class="recent-docs-header">
              <div class="recent-docs-title">
                <i class="fas fa-clock"></i>
                Recent Documents
              </div>
            </div>
            <div class="recent-docs-list" id="recentDocs"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Document Preview Modal -->
    <div id="previewModal" class="modal">
      <div
        class="modal-content"
        style="max-width: 90%; width: 90%; height: 80vh"
      >
        <div class="modal-header">
          <h2 class="modal-title">Document Preview</h2>
          <button
            class="close-btn"
            onclick="closeModal()"
            style="
              background: none;
              border: none;
              font-size: 1.5rem;
              cursor: pointer;
            "
          >
            &times;
          </button>
        </div>
        <div id="modalBody"></div>
      </div>
    </div>

    <script>
      //const API_URL = "http://localhost:8000";
      const API_URL = "https://intellidocs-aditya-backend.azurewebsites.net";
      let currentFilter = "all";
      let allResults = [];
      let filteredResults = [];
      let allDocuments = [];
      let isUploading = false;

      // Initialize
      document.addEventListener("DOMContentLoaded", () => {
        const savedTheme = localStorage.getItem("theme");
        if (savedTheme === "dark") {
          document.body.classList.add("dark-mode");
          document.getElementById("themeIcon").className = "fas fa-sun";
        }

        refreshAll();
        loadAllDocuments();
      });

      // Load all documents
      async function loadAllDocuments() {
        try {
          const response = await fetch(
            `${API_URL}/api/documents/recent?limit=100`
          );
          const data = await response.json();

          if (data.documents) {
            allDocuments = data.documents;
            updateFolderCounts();
          }
        } catch (error) {
          console.error("Failed to load documents:", error);
        }
      }

      // Update folder counts
      function updateFolderCounts() {
        const counts = {
          All: allDocuments.length,
          PDF: 0,
          Word: 0,
          Excel: 0,
          CSV: 0,
          PowerPoint: 0,
          Text: 0,
        };

        allDocuments.forEach((doc) => {
          const category = doc.category || "General";
          if (counts[category] !== undefined) {
            counts[category]++;
          }
        });

        document.getElementById("folderCountAll").textContent =
          `${counts.All} files`;
        document.getElementById("folderCountPDF").textContent =
          `${counts.PDF} files`;
        document.getElementById("folderCountWord").textContent =
          `${counts.Word} files`;
        document.getElementById("folderCountExcel").textContent =
          `${counts.Excel} files`;
        document.getElementById("folderCountCSV").textContent =
          `${counts.CSV} files`;
        document.getElementById("folderCountPowerPoint").textContent =
          `${counts.PowerPoint} files`;
        document.getElementById("folderCountText").textContent =
          `${counts.Text} files`;
      }

      function openFolder(folderType) {
        const modal = document.getElementById("folderModal");
        const title = document.getElementById("folderModalTitle");
        const filesList = document.getElementById("folderFilesList");

        title.innerHTML = `üìÅ ${folderType === "All" ? "All Documents" : folderType + " Files"}`;

        let folderDocs = allDocuments;
        if (folderType !== "All") {
          folderDocs = allDocuments.filter(
            (doc) => doc.category === folderType
          );
        }

        if (folderDocs.length === 0) {
          filesList.innerHTML = `
      <div style="text-align: center; padding: 2rem; color: #666;">
        <i class="fas fa-folder-open" style="font-size: 3rem; margin-bottom: 1rem;"></i>
        <p style="color: #666;">No ${folderType === "All" ? "" : folderType} documents found</p>
      </div>
    `;
        } else {
          let html = "";
          folderDocs.forEach((doc) => {
            const icon = getCategoryIcon(doc.category);
            const date = formatDate(doc.created_date);
            html += `
        <div class="folder-file-item" style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: #f8f9fa; margin-bottom: 0.5rem; border-radius: 8px;">
          <div style="display: flex; align-items: center; gap: 1rem;">
            <i class="fas ${icon}" style="font-size: 1.5rem; color: var(--primary-color);"></i>
            <div>
              <div style="font-weight: 600; color: #333;">${doc.title || "Untitled"}</div>
              <div style="font-size: 0.85rem; color: #666;">${date}</div>
            </div>
          </div>
          <button onclick="event.stopPropagation(); openDocumentFromFolder('${doc.id}')" 
                  style="padding: 0.5rem 1rem; background: var(--primary-color); color: white; border: none; border-radius: 6px; cursor: pointer;">
            <i class="fas fa-eye"></i> Open
          </button>
        </div>
      `;
          });
          filesList.innerHTML = html;
        }

        modal.classList.add("show");
      }

      function closeFolderModal() {
        document.getElementById("folderModal").classList.remove("show");
      }

      // Open document
      function openDocument(docId) {
        const doc = allDocuments.find((d) => d.id === docId);
        if (!doc) return;

        const modal = document.getElementById("previewModal");
        const modalBody = document.getElementById("modalBody");

        modalBody.innerHTML = `
                <div style="padding: 2rem;">
                    <h3>
                        <i class="fas ${getCategoryIcon(doc.category)}" style="color: var(--primary-color);"></i>
                        ${doc.title || "Untitled Document"}
                    </h3>
                    <div style="margin: 1rem 0;">
                        <span style="padding: 0.25rem 0.75rem; background: #f0f4f8; border-radius: 12px; color: #666;">
                            ${doc.category || "General"}
                        </span>
                        <span style="margin-left: 1rem; color: #666;">
                            <i class="fas fa-calendar"></i> ${formatDate(doc.created_date)}
                        </span>
                    </div>
                    <div style="margin-top: 1.5rem; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
                        <h4>Content Preview:</h4>
                        <p style="white-space: pre-wrap; line-height: 1.6;">
                            ${doc.content || doc.preview || "Full content not available"}
                        </p>
                    </div>
                    <button onclick="deleteDocument('${doc.id}')" style="
                        margin-top: 1rem;
                        padding: 0.5rem 1rem;
                        background: #dc3545;
                        color: white;
                        border: none;
                        border-radius: 8px;
                        cursor: pointer;
                    ">
                        <i class="fas fa-trash"></i> Delete Document
                    </button>
                </div>
            `;

        modal.classList.add("show");
        closeFolderModal();
      }
      async function openDocumentFromFolder(docId) {
        const modal = document.getElementById("previewModal");
        const modalBody = document.getElementById("modalBody");

        const isDarkMode = document.body.classList.contains("dark-mode");

        // Show loading state
        modalBody.innerHTML = `
    <div style="padding: 2rem; text-align: center;">
      <div style="width: 40px; height: 40px; border: 3px solid #ddd; 
          border-top: 3px solid var(--primary-color); border-radius: 50%; 
          animation: spin 1s linear infinite; margin: 0 auto;"></div>
      <p style="margin-top: 1rem; color: ${isDarkMode ? "var(--dark-text)" : "#333"};">Loading document...</p>
    </div>
  `;

        modal.classList.add("show");
        closeFolderModal();

        try {
          const response = await fetch(`${API_URL}/api/documents/${docId}`, {
            method: "GET",
            headers: { "Content-Type": "application/json" },
          });

          if (!response.ok) {
            throw new Error(
              `HTTP ${response.status}: ${await response.text()}`
            );
          }

          const doc = await response.json();
          const fullContent =
            doc.content || "Document content is empty or could not be loaded.";
          const wordCount = fullContent
            .split(/\s+/)
            .filter((word) => word.length > 0).length;

          // Reset modal body styles for proper layout
          modalBody.style.height = "auto";
          modalBody.style.maxHeight = "calc(80vh - 100px)";
          modalBody.style.overflow = "auto";
          modalBody.style.display = "block";
          modalBody.style.padding = "0";

          modalBody.innerHTML = `
      <div style="padding: 2rem; color: ${isDarkMode ? "var(--dark-text)" : "#333"};">
        <!-- Header Section -->
        <div style="margin-bottom: 1.5rem;">
          <h3 style="color: ${isDarkMode ? "var(--dark-text)" : "#333"}; margin: 0 0 1rem 0; font-size: 1.5rem;">
            <i class="fas ${getCategoryIcon(doc.category)}" style="color: var(--primary-color);"></i>
            ${doc.title || "Untitled Document"}
          </h3>
          
          <div style="display: flex; flex-wrap: wrap; gap: 1rem; margin-bottom: 1rem;">
            <span style="padding: 0.25rem 0.75rem; background: ${isDarkMode ? "var(--dark-bg)" : "#f0f4f8"}; border-radius: 12px; color: ${isDarkMode ? "var(--dark-text)" : "#666"}; font-size: 0.9rem;">
              ${doc.category || "General"}
            </span>
            <span style="color: ${isDarkMode ? "#aaa" : "#666"}; font-size: 0.9rem;">
              <i class="fas fa-calendar"></i> ${formatDate(doc.created_date)}
            </span>
            <span style="color: ${isDarkMode ? "#aaa" : "#666"}; font-size: 0.9rem;">
              <i class="fas fa-file-word"></i> ${wordCount.toLocaleString()} words
            </span>
            <span style="color: ${isDarkMode ? "#aaa" : "#666"}; font-size: 0.9rem;">
              <i class="fas fa-file-archive"></i> ${fullContent.length.toLocaleString()} characters
            </span>
          </div>
        </div>
        
        <!-- Content Section with consistent styling -->
        <div style="
          margin-bottom: 1.5rem;
          padding: 1.5rem;
          background: ${isDarkMode ? "var(--dark-bg)" : "#f8f9fa"};
          border-radius: 8px;
          border: 1px solid ${isDarkMode ? "var(--dark-border)" : "#ddd"};
        ">
          <h4 style="
            color: ${isDarkMode ? "var(--dark-text)" : "#333"}; 
            margin: 0 0 1rem 0;
            font-size: 1.1rem;
          ">
            üìÑ Full Document Content:
          </h4>
          
          <div id="documentContent" style="
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: break-word;
            line-height: 1.6;
            color: ${isDarkMode ? "var(--dark-text)" : "#333"};
            font-size: 1rem;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
          ">${fullContent}</div>
        </div>
        
        <!-- Action Buttons -->
        <div style="display: flex; gap: 1rem; justify-content: space-between; flex-wrap: wrap;">
          <div style="display: flex; gap: 1rem;">
            <button onclick="deleteDocument('${doc.id}')" style="
              padding: 0.75rem 1.25rem;
              background: #dc3545;
              color: white;
              border: none;
              border-radius: 8px;
              cursor: pointer;
              font-weight: 500;
              transition: all 0.3s;
            " onmouseover="this.style.opacity='0.9'" onmouseout="this.style.opacity='1'">
              <i class="fas fa-trash"></i> Delete
            </button>
            
            <button onclick="closeModal()" style="
              padding: 0.75rem 1.25rem;
              background: #6c757d;
              color: white;
              border: none;
              border-radius: 8px;
              cursor: pointer;
              font-weight: 500;
              transition: all 0.3s;
            " onmouseover="this.style.opacity='0.9'" onmouseout="this.style.opacity='1'">
              <i class="fas fa-times"></i> Close
            </button>
          </div>
          
          <button onclick="copyFullDocumentContent()" style="
            padding: 0.75rem 1.25rem;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
          " onmouseover="this.style.opacity='0.9'" onmouseout="this.style.opacity='1'">
            <i class="fas fa-copy"></i> Copy Content
          </button>
        </div>
      </div>
    `;
        } catch (error) {
          console.error("Error loading document:", error);
          modalBody.innerHTML = `
      <div style="padding: 2rem; text-align: center; color: ${isDarkMode ? "var(--dark-text)" : "#333"};">
        <i class="fas fa-exclamation-circle" style="font-size: 3rem; color: #dc3545; margin-bottom: 1rem;"></i>
        <h3>‚ùå Error Loading Document</h3>
        <p style="color: ${isDarkMode ? "#aaa" : "#666"}; margin: 1rem 0;">${error.message}</p>
        <button onclick="closeModal()" style="
          margin-top: 1.5rem; padding: 0.75rem 1.25rem; background: #6c757d;
          color: white; border: none; border-radius: 8px; cursor: pointer;
        ">Close</button>
      </div>
    `;
        }
      }

      // Helper function to copy document content
      function copyFullDocumentContent() {
        const contentElement = document.getElementById("documentContent");
        if (!contentElement) {
          showToast("error", "No content to copy");
          return;
        }

        const text = contentElement.textContent;

        if (navigator.clipboard && navigator.clipboard.writeText) {
          navigator.clipboard
            .writeText(text)
            .then(() => {
              showToast("success", "‚úÖ Document content copied to clipboard!");
            })
            .catch((err) => {
              console.error("Clipboard error:", err);
              fallbackCopy(text);
            });
        } else {
          fallbackCopy(text);
        }
      }

      function fallbackCopy(text) {
        const textArea = document.createElement("textarea");
        textArea.value = text;
        textArea.style.position = "fixed";
        textArea.style.left = "-999999px";
        textArea.style.top = "-999999px";
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();

        try {
          const successful = document.execCommand("copy");
          if (successful) {
            showToast("success", "‚úÖ Document content copied to clipboard!");
          } else {
            showToast("error", "Failed to copy content");
          }
        } catch (err) {
          console.error("Fallback copy error:", err);
          showToast("error", "Failed to copy content");
        }

        document.body.removeChild(textArea);
      }

      function copyToClipboard(text) {
        navigator.clipboard
          .writeText(text)
          .then(() => {
            showToast("success", "Content copied to clipboard!");
          })
          .catch(() => {
            showToast("error", "Failed to copy content");
          });
      }

      // Delete document
      async function deleteDocument(docId) {
        if (!confirm("Are you sure you want to delete this document?")) {
          return;
        }

        try {
          const response = await fetch(`${API_URL}/api/documents/${docId}`, {
            method: "DELETE",
          });

          if (response.ok) {
            showToast("success", "Document deleted successfully!");
            closeModal();
            refreshAll();
          } else {
            showToast("error", "Failed to delete document");
          }
        } catch (error) {
          showToast("error", "Failed to delete document");
        }
      }

      // Theme Toggle
      function toggleTheme() {
        document.body.classList.toggle("dark-mode");
        const isDark = document.body.classList.contains("dark-mode");
        const icon = document.getElementById("themeIcon");
        icon.className = isDark ? "fas fa-sun" : "fas fa-moon";
        localStorage.setItem("theme", isDark ? "dark" : "light");
      }

      // Refresh All
      async function refreshAll() {
        const refreshBtn = document.querySelector(".refresh-button");
        if (refreshBtn) {
          refreshBtn.classList.add("spinning");
        }

        await Promise.all([
          refreshStats(),
          loadRecentDocuments(),
          loadAllDocuments(),
        ]);

        setTimeout(() => {
          if (refreshBtn) {
            refreshBtn.classList.remove("spinning");
          }
        }, 1000);
      }

      // Toast Notifications
      function showToast(type, message) {
        const toastContainer = document.getElementById("toastContainer");
        const toast = document.createElement("div");
        toast.className = `toast ${type}`;

        const icon = {
          success: "fa-check-circle",
          error: "fa-exclamation-circle",
          info: "fa-info-circle",
          warning: "fa-exclamation-triangle",
        }[type];

        toast.innerHTML = `
                <i class="fas ${icon}"></i>
                <span>${message}</span>
                <span class="toast-close" onclick="this.parentElement.remove()">√ó</span>
            `;

        toastContainer.appendChild(toast);

        setTimeout(() => {
          toast.remove();
        }, 4000);
      }

      // Search
      async function performSearch() {
        const query = document.getElementById("searchInput").value.trim();
        if (!query) {
          showToast("warning", "Please enter a search query");
          return;
        }

        const resultsDiv = document.getElementById("searchResults");
        const resultHeader = document.querySelector(".result-count");

        resultsDiv.innerHTML = `
                <div class="empty-state">
                    <div style="width: 40px; height: 40px; border: 3px solid #ddd; 
                        border-top: 3px solid var(--primary-color); border-radius: 50%; 
                        animation: spin 1s linear infinite; margin: 0 auto;"></div>
                    <p style="margin-top: 1rem;">Searching...</p>
                </div>
            `;

        try {
          const response = await fetch(`${API_URL}/api/search`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              query: query,
              top: 50,
            }),
          });

          if (!response.ok) {
            throw new Error("Search failed");
          }

          const data = await response.json();
          allResults = data.results || [];

          const searchCount = parseInt(
            document.getElementById("searchCount").textContent || "0"
          );
          document.getElementById("searchCount").textContent = searchCount + 1;

          if (allResults.length === 0) {
            resultsDiv.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon">
                                <i class="fas fa-inbox"></i>
                            </div>
                            <h3>No Results Found</h3>
                            <p>No documents found for "${query}"</p>
                        </div>
                    `;
            resultHeader.textContent = "No results found";
          } else {
            resultHeader.textContent = `Found ${allResults.length} results`;
            applyFilterAndDisplay(query);
          }
        } catch (error) {
          console.error("Search error:", error);
          resultsDiv.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">
                            <i class="fas fa-exclamation-circle" style="color: red;"></i>
                        </div>
                        <h3>Search Error</h3>
                        <p>Unable to search. Please try again.</p>
                    </div>
                `;
        }
      }

      const Search = performSearch; // Alias for the search button onclick

      function applyFilterAndDisplay(query) {
        if (currentFilter === "all") {
          filteredResults = allResults;
        } else {
          filteredResults = allResults.filter((result) => {
            const category = result.category || "General";
            return category === currentFilter;
          });
        }

        displayResults(filteredResults, query);
      }

      function displayResults(results, query) {
        const resultsDiv = document.getElementById("searchResults");

        let html = "";
        results.forEach((result) => {
          const snippet = result.content
            ? result.content.substring(0, 500) + "..."
            : "No preview available";

          html += `
                    <div onclick="viewDocument('${result.id}')" style="
                        padding: 1.5rem; 
                        margin-bottom: 1rem; 
                        border: 1px solid #e0e0e0; 
                        border-radius: 12px; 
                        cursor: pointer; 
                        background: white;
                        transition: all 0.3s;
                    " onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)'" 
                       onmouseout="this.style.boxShadow='none'">
                        
                        <h3 style="color: #1e3c72; margin: 0 0 0.5rem 0;">
                            <i class="fas ${getCategoryIcon(result.category)}"></i>
                            ${result.title || "Untitled"}
                        </h3>
                        
                        <p style="color: #666; margin: 0.5rem 0;">
                            ${snippet}
                        </p>
                        
                        <div style="display: flex; gap: 1rem; font-size: 0.85rem; color: #999;">
                            <span>Score: ${result.score}</span>
                            <span>${result.word_count || 0} words</span>
                            <span>${result.category || "General"}</span>
                        </div>
                    </div>
                `;
        });

        resultsDiv.innerHTML = html;
      }

      function viewDocument(docId) {
        const doc =
          allResults.find((r) => r.id === docId) ||
          allDocuments.find((d) => d.id === docId);
        if (!doc) return;

        const modal = document.getElementById("previewModal");
        const modalBody = document.getElementById("modalBody");
        const fullContent =
          doc.content || doc.preview || "Full content not available";
        const isDarkMode = document.body.classList.contains("dark-mode");
        const wordCount = fullContent
          .split(/\s+/)
          .filter((word) => word.length > 0).length;

        // Reset modal body styles for proper layout
        modalBody.style.height = "auto";
        modalBody.style.maxHeight = "calc(80vh - 100px)";
        modalBody.style.overflow = "auto";
        modalBody.style.display = "block";
        modalBody.style.padding = "0";

        modalBody.innerHTML = `
    <div style="padding: 2rem; color: ${isDarkMode ? "var(--dark-text)" : "#333"};">
      <!-- Header Section -->
      <div style="margin-bottom: 1.5rem;">
        <h3 style="color: ${isDarkMode ? "var(--dark-text)" : "#333"}; margin: 0 0 1rem 0; font-size: 1.5rem;">
          <i class="fas ${getCategoryIcon(doc.category)}" style="color: var(--primary-color);"></i>
          ${doc.title || "Untitled Document"}
        </h3>
        
        <div style="display: flex; flex-wrap: wrap; gap: 1rem; margin-bottom: 1rem;">
          <span style="padding: 0.25rem 0.75rem; background: ${isDarkMode ? "var(--dark-bg)" : "#f0f4f8"}; border-radius: 12px; color: ${isDarkMode ? "var(--dark-text)" : "#666"}; font-size: 0.9rem;">
            ${doc.category || "General"}
          </span>
          <span style="color: ${isDarkMode ? "#aaa" : "#666"}; font-size: 0.9rem;">
            <i class="fas fa-calendar"></i> ${formatDate(doc.created_date)}
          </span>
          <span style="color: ${isDarkMode ? "#aaa" : "#666"}; font-size: 0.9rem;">
            <i class="fas fa-file-word"></i> ${wordCount.toLocaleString()} words
          </span>
        </div>
      </div>
      
      <!-- Content Section with consistent styling -->
      <div style="
        margin-bottom: 1.5rem;
        padding: 1.5rem;
        background: ${isDarkMode ? "var(--dark-bg)" : "#f8f9fa"};
        border-radius: 8px;
        border: 1px solid ${isDarkMode ? "var(--dark-border)" : "#ddd"};
      ">
        <h4 style="
          color: ${isDarkMode ? "var(--dark-text)" : "#333"}; 
          margin: 0 0 1rem 0;
          font-size: 1.1rem;
        ">
          üìÑ Full Document Content:
        </h4>
        
        <div id="documentContent" style="
          white-space: pre-wrap;
          word-wrap: break-word;
          word-break: break-word;
          line-height: 1.6;
          color: ${isDarkMode ? "var(--dark-text)" : "#333"};
          font-size: 1rem;
          font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        ">${fullContent}</div>
      </div>
      
      <!-- Action Buttons -->
      <div style="display: flex; gap: 1rem; justify-content: space-between; flex-wrap: wrap;">
        <div style="display: flex; gap: 1rem;">
          <button onclick="deleteDocument('${doc.id}')" style="
            padding: 0.75rem 1.25rem;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
          ">
            <i class="fas fa-trash"></i> Delete Document
          </button>
          <button onclick="closeModal()" style="
            padding: 0.75rem 1.25rem;
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
          ">
            <i class="fas fa-times"></i> Close
          </button>
        </div>
        
        <button onclick="copyFullDocumentContent()" style="
          padding: 0.75rem 1.25rem;
          background: var(--primary-color);
          color: white;
          border: none;
          border-radius: 8px;
          cursor: pointer;
          font-weight: 500;
        ">
          <i class="fas fa-copy"></i> Copy Content
        </button>
      </div>
    </div>
  `;

        modal.classList.add("show");
        if (typeof closeFolderModal !== "undefined") {
          closeFolderModal();
        }
      }
      function toggleFilter(element, filter) {
        document.querySelectorAll(".filter-chip").forEach((chip) => {
          chip.classList.remove("active");
        });
        element.classList.add("active");
        currentFilter = filter;

        if (allResults.length > 0) {
          const query = document.getElementById("searchInput").value;
          applyFilterAndDisplay(query);
        }
      }

      function sortResults(sortBy) {
        if (!filteredResults || filteredResults.length === 0) return;

        switch (sortBy) {
          case "title":
            filteredResults.sort((a, b) =>
              (a.title || "").localeCompare(b.title || "")
            );
            break;
          case "date":
            filteredResults.sort((a, b) => {
              const dateA = new Date(a.created_date || 0);
              const dateB = new Date(b.created_date || 0);
              return dateB - dateA;
            });
            break;
          case "relevance":
          default:
            filteredResults.sort((a, b) => (b.score || 0) - (a.score || 0));
        }

        const query = document.getElementById("searchInput").value;
        displayResults(filteredResults, query);
      }

      // File Upload
      function handleSingleDrop(event) {
        event.preventDefault();
        event.currentTarget.classList.remove("dragover");

        const files = event.dataTransfer.files;
        if (files.length > 0) {
          uploadSingleFile(files[0]);
        }
      }

      function handleDragOver(event) {
        event.preventDefault();
        event.currentTarget.classList.add("dragover");
      }

      function handleDragLeave(event) {
        event.currentTarget.classList.remove("dragover");
      }

      function handleSingleFile(event) {
        const file = event.target.files[0];
        if (file) {
          uploadSingleFile(file);
        }
      }

      async function uploadSingleFile(file) {
        if (isUploading) {
          showToast("warning", "Please wait for current upload to complete");
          return;
        }

        const maxSize = 10 * 1024 * 1024; // 10MB
        if (file.size > maxSize) {
          showToast("error", "File size exceeds 10MB limit");
          return;
        }

        isUploading = true;
        const uploadProgress = document.getElementById("uploadProgress");
        const progressFill = document.getElementById("progressFill");
        const statusText = document.getElementById("uploadStatusText");

        uploadProgress.style.display = "block";
        statusText.textContent = `Uploading: ${file.name}`;
        progressFill.style.width = "0%";

        setTimeout(() => {
          progressFill.style.width = "50%";
        }, 100);

        try {
          const formData = new FormData();
          formData.append("file", file);

          const response = await fetch(`${API_URL}/api/documents/upload-file`, {
            method: "POST",
            body: formData,
          });

          const data = await response.json();

          if (response.ok && data.document_id) {
            progressFill.style.width = "100%";
            statusText.textContent = `‚úÖ Successfully uploaded: ${file.name}`;
            showToast("success", `File "${file.name}" uploaded successfully!`);

            setTimeout(() => {
              refreshAll();
            }, 500);
          } else {
            throw new Error(data.error || "Upload failed");
          }
        } catch (error) {
          console.error("Upload error:", error);
          progressFill.style.width = "0%";
          statusText.textContent = `‚ùå Failed to upload: ${file.name}`;
          showToast("error", `Failed to upload: ${error.message}`);
        } finally {
          setTimeout(() => {
            uploadProgress.style.display = "none";
            progressFill.style.width = "0%";
            document.getElementById("fileInput").value = "";
            isUploading = false;
          }, 3000);
        }
      }

      // Recent Documents
      async function loadRecentDocuments() {
        try {
          const response = await fetch(
            `${API_URL}/api/documents/recent?limit=10`
          );
          const data = await response.json();

          if (data.documents && data.documents.length > 0) {
            displayRecentDocuments(data.documents);
          } else {
            displayEmptyRecentDocs();
          }
        } catch (error) {
          console.error("Failed to load recent documents:", error);
          displayEmptyRecentDocs();
        }
      }

      function displayRecentDocuments(documents) {
        const docList = document.getElementById("recentDocs");

        let html = "";
        documents.forEach((doc) => {
          const iconClass = getDocIconClass(doc.category);
          const timeAgo = getTimeAgo(doc.created_date);

          html += `
                    <div class="recent-doc-item" onclick="openDocument('${doc.id}')">
                        <div class="recent-doc-icon ${iconClass}">
                            <i class="fas ${getCategoryIcon(doc.category)}"></i>
                        </div>
                        <div class="recent-doc-info">
                            <div class="recent-doc-title">${doc.title || "Untitled"}</div>
                            <div class="recent-doc-meta">
                                <span class="recent-doc-time">
                                    <i class="fas fa-clock"></i> ${timeAgo}
                                </span>
                                <span>${doc.category || "General"}</span>
                            </div>
                        </div>
                    </div>
                `;
        });

        docList.innerHTML = html;
      }

      function displayEmptyRecentDocs() {
        document.getElementById("recentDocs").innerHTML = `
                <div style="text-align: center; padding: 2rem; color: #999;">
                    <i class="fas fa-inbox" style="font-size: 2rem; margin-bottom: 1rem;"></i>
                    <p>No recent documents</p>
                    <p style="font-size: 0.85rem; margin-top: 0.5rem;">Upload documents to see them here</p>
                </div>
            `;
      }

      // Update getCategoryIcon function
      function getCategoryIcon(category) {
        const icons = {
          PDF: "fa-file-pdf",
          Word: "fa-file-word",
          Excel: "fa-file-excel",
          CSV: "fa-file-csv",
          PowerPoint: "fa-file-powerpoint",
          Text: "fa-file-alt",
          General: "fa-file",
          HR: "fa-users",
          IT: "fa-laptop-code",
          Policy: "fa-book",
        };
        return icons[category] || "fa-file";
      }

      // Update getDocIconClass function
      function getDocIconClass(category) {
        const classes = {
          PDF: "pdf",
          Word: "word",
          Excel: "excel",
          CSV: "excel", // Use excel style for CSV (green color)
          PowerPoint: "powerpoint",
          Text: "text",
        };
        return classes[category] || "text";
      }

      function formatDate(dateString) {
        if (!dateString) return "Date not available";
        try {
          const date = new Date(dateString);
          const now = new Date();
          const diffTime = Math.abs(now - date);
          const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));

          if (diffDays === 0) {
            return "Today";
          } else if (diffDays === 1) {
            return "Yesterday";
          } else if (diffDays < 7) {
            return `${diffDays} days ago`;
          } else {
            return date.toLocaleDateString("en-US", {
              year: "numeric",
              month: "short",
              day: "numeric",
            });
          }
        } catch (e) {
          return "Date not available";
        }
      }

      function getTimeAgo(dateString) {
        if (!dateString) return "Unknown time";

        const date = new Date(dateString);
        const now = new Date();
        const diffMs = now - date;
        const diffMins = Math.floor(diffMs / 60000);

        if (diffMins < 1) return "Just now";
        if (diffMins < 60) return `${diffMins} min ago`;
        if (diffMins < 1440) {
          const hours = Math.floor(diffMins / 60);
          return `${hours} hour${hours > 1 ? "s" : ""} ago`;
        }

        const days = Math.floor(diffMins / 1440);
        return `${days} day${days > 1 ? "s" : ""} ago`;
      }

      // Statistics
      async function refreshStats() {
        try {
          const response = await fetch(`${API_URL}/api/stats`);
          const data = await response.json();

          if (!data.error) {
            document.getElementById("totalDocs").textContent =
              data.total_documents || 0;
          }
        } catch (error) {
          console.error("Failed to fetch stats:", error);
        }
      }

      // Modal Functions
      function closeModal() {
        document.getElementById("previewModal").classList.remove("show");
      }

      window.onclick = function (event) {
        const modal = document.getElementById("previewModal");
        const folderModal = document.getElementById("folderModal");
        if (event.target === modal) {
          closeModal();
        }
        if (event.target === folderModal) {
          closeFolderModal();
        }
      };

      // Keyboard shortcuts
      document.addEventListener("keydown", function (event) {
        if ((event.ctrlKey || event.metaKey) && event.key === "k") {
          event.preventDefault();
          document.getElementById("searchInput").focus();
        }

        if (event.key === "Escape") {
          closeModal();
          closeFolderModal();
        }
      });

      // Replace 'yourSearchFunctionName' with the actual name of your search function
      document.querySelector(".search-btn").onclick = performSearch;
    </script>
  </body>
</html>
